<!DOCTYPE html>
<html lang="vi" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{_layout}">
<head>
    <title>Quản Lý Sản Phẩm</title>
    <style>
        /* responsive card grid for small screens */
        .card-grid { display: none; gap: 1rem; }
        .product-card { background: white; border-radius: 12px; padding: 1rem; box-shadow: 0 6px 18px rgba(0,0,0,0.06); }
        .product-card img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
        .product-card .meta { margin-top: 0.75rem; display:flex; justify-content:space-between; align-items:center; }

        @media (max-width: 900px) {
            .table { display: none; }
            .card-grid { display: grid; grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div layout:fragment="content">
        <div class="page-header">
            <h1><i class="fas fa-box-open"></i> Quản Lý Sản Phẩm</h1>
            <p>Xem danh sách, thêm mới, chỉnh sửa hoặc xóa sản phẩm của bạn</p>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input id="searchInput" type="text" class="form-control" placeholder="Tìm theo tên hoặc danh mục..." oninput="filterProducts()">
                </div>
            </div>
            <div class="col-md-6 text-end">
                <button type="button" class="btn btn-create" data-bs-toggle="modal" data-bs-target="#createProductModal">
                    <i class="fas fa-plus"></i> Thêm Sản Phẩm Mới
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table" th:if="${!listproduct.isEmpty()}">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Tên Sản Phẩm</th>
                        <th>Giá</th>
                        <th>Hình Ảnh</th>
                        <th>Danh Mục</th>
                        <th style="text-align:center;">Thao Tác</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <tr th:each="product : ${listproduct}" data-name="[[${product.name}]]" data-category="[[${product.category?.name}]]">
                        <td><strong th:text="${product.id}"></strong></td>
                        <td th:text="${product.name}"></td>
                        <td><span class="price"><i class="fas fa-coins"></i> [[${#numbers.formatInteger(product.price,0)}]] đ</span></td>
                        <td>
                            <img height="80" width="120" th:src="@{/images/} + ${product.image}" alt="product image" class="product-img" onerror="this.src='/images/placeholder.png'">
                        </td>
                        <td><span class="badge-category" th:text="${product.category?.name ?: 'Không xác định'}"></span></td>
                        <td style="text-align:center;">
                            <a th:href="@{/products/edit/{id}(id=${product.id})}" class="btn btn-sm btn-action-edit"><i class="fas fa-edit"></i></a>
                            <form th:action="@{/products/delete/{id}(id=${product.id})}" method="post" style="display:inline">
                                <button type="submit" class="btn btn-sm btn-action-delete" onclick="return confirm('Bạn có chắc chắn muốn xóa?')"><i class="fas fa-trash"></i></button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Card grid for mobile -->
            <div class="card-grid" id="cardGrid">
                <div class="product-card" th:each="product : ${listproduct}" data-name="[[${product.name}]]" data-category="[[${product.category?.name}]]">
                    <img th:src="@{/images/} + ${product.image}" alt="product image" onerror="this.src='/images/placeholder.png'">
                    <h5 style="margin-top:0.75rem;" th:text="${product.name}"></h5>
                    <p class="price"><i class="fas fa-coins"></i> [[${#numbers.formatInteger(product.price,0)}]] đ</p>
                    <div class="meta">
                        <span class="badge-category" th:text="${product.category?.name ?: 'Không xác định'}"></span>
                        <div>
                            <a th:href="@{/products/edit/{id}(id=${product.id})}" class="btn btn-sm btn-action-edit"><i class="fas fa-edit"></i></a>
                            <form th:action="@{/products/delete/{id}(id=${product.id})}" method="post" style="display:inline">
                                <button type="submit" class="btn btn-sm btn-action-delete" onclick="return confirm('Bạn có chắc chắn muốn xóa?')"><i class="fas fa-trash"></i></button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty state -->
            <div class="empty-state" th:if="${listproduct.isEmpty()}">
                <i class="fas fa-inbox"></i>
                <h4>Chưa có sản phẩm nào</h4>
                <p>Hãy thêm sản phẩm đầu tiên của bạn!</p>
                <button type="button" class="btn btn-create mt-3" data-bs-toggle="modal" data-bs-target="#createProductModal">
                    <i class="fas fa-plus"></i> Thêm Sản Phẩm
                </button>
            </div>
        </div>
    </div>

    <!-- Create Product Modal -->
    <div class="modal fade" id="createProductModal" tabindex="-1" aria-labelledby="createProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="createProductModalLabel">
                        <i class="fas fa-plus-circle"></i> Tạo Sản Phẩm Mới
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted"><i class="fas fa-info-circle"></i> Nhấp nút bên dưới để mở form tạo sản phẩm chi tiết</p>
                    <div style="text-align: center; padding: 2rem;">
                        <a th:href="@{/products/create}" class="btn btn-create btn-lg" style="padding: 1rem 3rem;">
                            <i class="fas fa-arrow-right"></i> Mở Form Tạo Sản Phẩm
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Đóng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function filterProducts() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#productTableBody tr');
            rows.forEach(r => {
                const name = r.getAttribute('data-name')?.toLowerCase() || '';
                const cat = r.getAttribute('data-category')?.toLowerCase() || '';
                r.style.display = (name.includes(q) || cat.includes(q)) ? '' : 'none';
            });

            const cards = document.querySelectorAll('#cardGrid .product-card');
            cards.forEach(c => {
                const name = c.getAttribute('data-name')?.toLowerCase() || '';
                const cat = c.getAttribute('data-category')?.toLowerCase() || '';
                c.style.display = (name.includes(q) || cat.includes(q)) ? '' : 'none';
            });
        }
    </script>
</body>
</html>
